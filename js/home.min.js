var endPointSendData="https://MQLDVVAS4552.compartamos.mx:8600/prospeccion-web/web/v1/solicitud/submit";const MSG_ERROR_GRAL="No se pudo mandar la informaci\xf3n. Int\xe9ntelo m\xe1s tarde";function muestraAviso(){document.getElementById("divAvisoPri").style.display="flex"}function cerrarAviso(){document.getElementById("divAvisoPri").style.display="none"}function spinnerOn(e){$.blockUI({css:{border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.7,color:"#fff"},fadeIn:0,message:'<i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i>'+e,baseZ:99995,overlayCSS:{backgroundColor:"#000",opacity:.7,cursor:"wait"}})}function spinnerOff(){0!=$(".blockUI").length&&$.unblockUI()}function utms(){for(var e,t=[],o=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),a=0;a<o.length;a++)("utm_source"==(e=o[a].split("="))[0]||"utm_medium"==e[0]||"utm_content"==e[0]||"utm_campaign"==e[0])&&(t.push(e[0]),t[e[0]]=e[1]);return t}function clearForm(){$("input").val(""),$("select").val(0),$("input[type=checkbox]").prop("checked",!1),$("input[type=radio]").prop("checked",!1),formDisable()}$(document).ready(function(){$('input[type="radio"]').prop("checked",!1),$("input[name=id_question]").val("1"),$("#msError").hide(),$(".desktop-footer").hide(),$("#avisoPrivacidad").on("change",function(){$(this).is(":checked")?$(this).css("accent-color","#CE0058"):$(this).css("accent-color","initial")}),localStorage.setItem("CompartamosGenero",""),localStorage.setItem("CompartamosNombre",""),localStorage.setItem("CompartamosAP",""),localStorage.setItem("CompartamosAM",""),localStorage.setItem("CompartamosFecha",""),localStorage.setItem("CompartamosTipoTelefono",""),localStorage.setItem("CompartamosCorreo",""),localStorage.setItem("CompartamosHorario",""),localStorage.setItem("CompartamosCPGD",""),localStorage.setItem("CompartamosHojaFormulario",1),localStorage.setItem("tipoCredito","N/A"),localStorage.setItem("productoAdicional","N/A"),localStorage.setItem("negocio","N/A"),localStorage.setItem("antiguedad","N/A");let e=/^[a-zA-ZÀ-ÿ\u00f1\u00d1]+(\s+[a-zA-ZÀ-ÿ\u00f1\u00d1]+)*$/;var t=!0,o=!0,a=!1,n=!0,r=!0,s=!0,i=!0,l=!1,d=!0,c=!0,p=!1,u="N/A",m="N/A",v="N/A",C="N/A",g="N/A",h="",f="",b="",_="",E="",I="",y="",q="",S="";function w(){let e=$("input[name=answer_question_4_1]").val();if($(".desktop-footer").hide(),""==e)return $("#msgError").html("Seleccione una respuesta.").show(),!1;$(".question__content").hide(),C=e,localStorage.setItem("productoAdicional",C),window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"form_field_steps",CDCategory:$("input[name=answer_question_2_1]").val(),CDFunnel:"cliente",CDSource:ssSource,pantalla:"pantalla_1-60%",field_name:"03. Producto seleccionado",field_value:C}),$("#q3_2").show(),$("input[name=id_question]").val("3_2"),$("#q3_2 .progress__label span").html("90%"),$("#q3_2 .progress__line").addClass("p80"),$("#q3_2 .tipoCredito").hide(),$("#btnContinue").removeClass("active"),$("#btnContinue").show()}function A(){let u=$(this),v=u.attr("id"),C=u.val(),g=document.getElementById("textError"+v);switch(v){case"txbNombre":(G=C,e.test(G))?(g.style.display="none",$("#txbNombre").removeClass("inputError"),t=!1,h=C,localStorage.setItem("CompartamosNombre",C)):(g.style.display="block",$("#txbNombre").addClass("inputError"),t=!0);break;case"txbApPaterno":(B=C,e.test(B))?(g.style.display="none",$("#txbApPaterno").removeClass("inputError"),o=!1,f=C,localStorage.setItem("CompartamosAP",C)):(g.style.display="block",$("#txbApPaterno").addClass("inputError"),o=!0);break;case"txbApMaterno":C.length>0?(R=C,e.test(R))?(g.style.display="none",$("#txbApMaterno").removeClass("inputError"),a=!1,b=C,localStorage.setItem("CompartamosAM",C)):(g.style.display="block",$("#txbApMaterno").addClass("inputError"),a=!0):(g.style.display="none",$("#txbApMaterno").removeClass("inputError"),a=!1);break;case"diaSelect":case"mesSelect":case"anioSelect":let w=$("#diaSelect").val(),A=$("#mesSelect").val(),k=$("#anioSelect").val(),x=document.getElementById("textErrorFecha");N(w,A,k)?(x.style.display="none",$("#diaSelect").removeClass("inputError"),$("#mesSelect").removeClass("inputError"),$("#anioSelect").removeClass("inputError"),n=!1,_=C):(x.style.display="block",$("#diaSelect").addClass("inputError"),$("#mesSelect").addClass("inputError"),$("#anioSelect").addClass("inputError"),n=!0);break;case"rbFemenino":case"rbMasculino":var P,D,T=$("input[name='rbSexo']:checked").val();T?($("#textErrorGenero").hide(),c=!1,S=C,localStorage.setItem("CompartamosGenero",T)):($("#textErrorGenero").show(),c=!0);break;case"txbNumeroTel":case"telefonoSelec":var G,B,R,M,F=$("#telefonoSelect").val(),O=$("#txbNumeroTel").val();let L=(M=O,"0"===(M=M.replace(/[-\s+]/g,"").trim())[0]?"errorPrimerDigito":/^[0-9]{10}$/.test(M)?M:"numeroInvalido");"errorPrimerDigito"===L?($("#textErrorTelefono1").css("display","block"),$("#txbNumeroTel").addClass("inputError"),r=!0):"numeroInvalido"===L?($("#textErrorTelefono").css("display","block"),$("#txbNumeroTel").addClass("inputError"),r=!0):($("#textErrorTelefono").css("display","none"),$("#textErrorTelefono1").css("display","none"),$("#txbNumeroTel").removeClass("inputError"),r=!1,validarTelefono=L,localStorage.setItem("CompartamosTipoTelefono",F),localStorage.setItem("CompartamosTelefono",O));break;case"horaSelect":let H=C;"0"===H||null===H?(g.style.display="block",$("#horaSelect").addClass("inputError"),s=!0):(g.style.display="none",$("#horaSelect").removeClass("inputError"),s=!1,E=C,localStorage.setItem("CompartamosHorario",H));break;case"txbCP":(P=C,/^\d{5}$/.test(P))?(g.style.display="none",$("#txbCP").removeClass("inputError"),i=!1,I=C):(g.style.display="block",$("#txbCP").addClass("inputError"),erroreraValidacion=!1,i=!0);break;case"txbCorreoElectronico":(D=C,0==D.trim().length||/^(?:[^<>()[\].,;:\s@"]+(\.[^<>()[\].,;:\s@"]+)*|"[^\n"]+")@(?:[^<>()[\].,;:\s@"]+\.)+[^<>()[\]\.,;:\s@"]{2,63}$/i.test(D))?(g.style.display="none",l=!1,$("#txbCorreoElectronico").removeClass("inputError"),y=C,l=!1):(g.style.display="block",$("#txbCorreoElectronico").addClass("inputError"),l=!0,localStorage.setItem("CompartamosCorreo",C));break;case"avisoPrivacidad":u.prop("checked")?($("#textErrorAviso").hide(),d=!1,q=!1):(d=!0,q=!0)}r=!1;var Y=t||o||a||r||i,z=n||c||s||l;"N/A"==m?Y||z||d?($("#btnContinue").removeClass("active"),p=!1):($("#btnContinue").addClass("active"),p=!0):Y||d?($("#btnContinue").removeClass("active"),p=!1):($("#btnContinue").addClass("active"),p=!0)}function N(e,t,o){var a,n,r,s,i;if("0"===e||"0"===t||"0"===o)return!1;let l=new Date(o,t-1,e);if(l.getDate()!=e||l.getMonth()+1!=t||l.getFullYear()!=o)return!1;let d=(a=l,n=new Date,r=new Date(a),s=n.getFullYear()-r.getFullYear(),i=n.getMonth()-r.getMonth(),(i<0||0===i&&n.getDate()<r.getDate())&&s--,s);return!(d<18)&&!(d>98)}function N(e,t,o){if(!document.getElementById("diaSelect"))return!0;if("0"===e||"0"===t||"0"===o)return!1;let a=new Date(o,t-1,e);return a.getDate()==e&&a.getMonth()+1==t&&a.getFullYear()==o}$("#q1 .answer").on("click",function(){let e=$(this).attr("data-id");$("#q1 .answer").removeClass("selected"),$(this).addClass("selected"),"Si"===e?$("#rbCSi").prop("checked",!0):"No"===e&&$("#rbCNo").prop("checked",!0),u=e,$("input[name=answer_question_1]").val(e),$("#btnContinue").addClass("active"),$("#msgError").hide()}),$("#q2_1 .answer").on("click",function(){let e=$(this).attr("data-id");$("#q2_1 .answer").removeClass("selected"),$(this).addClass("selected"),"Grupal"===e?$("#rbGrupalSi").prop("checked",!0):"Individual"===e&&$("#rbIndividualNo").prop("checked",!0),m=e,$("input[name=answer_question_2_1]").val(e),$("#btnContinue").addClass("active"),$("#msgError").hide()}),$("#q2_2 .answer").on("click",function(){let e=$(this).attr("data-id");$("#q2_2 .answer").removeClass("selected"),$(this).addClass("selected"),"Si"===e?($("#rbSi").prop("checked",!0),v="Si"):"No"===e&&($("#rbNo").prop("checked",!0),v="No"),$("input[name=answer_question_2_2]").val(e),$("#btnContinue").addClass("active"),$("#msgError").hide()}),$("#q3_1 .answer").on("click",function(){let e=$(this).attr("data-id");$("#q3_1 .answer").removeClass("selected"),$(this).addClass("selected"),"Si"===e?($("#rbSiNegocio").prop("checked",!0),g="Si"):"No"===e&&($("#rbNoNegocio").prop("checked",!0),g="No"),$("input[name=answer_question_3_1]").val(e),$("#btnContinue").addClass("active"),$("#msgError").hide()}),$("#q3_2 .answer").on("change",A),$("#q3_2 .answer").on("blur",A),$("#btnContinue").on("click",function(){var e;let t=$("input[name=id_question]").val();1==t?function e(){let t=$("input[name=answer_question_1]").val();if(""==t)return $("#msgError").html("Seleccione una respuesta.").show(),!1;$(".question__content").hide(),"Si"==t?($("#q2_1").show(),$("input[name=id_question]").val("2_1"),$("#q2_1 .progress__label span").html("30%"),$("#q2_1 .progress__line").addClass("p30")):($("#q2_2").show(),$("input[name=id_question]").val("2_2"),$("#q2_2 .progress__label span").html("30%"),$("#q2_2 .progress__line").addClass("p30")),$("#btnContinue").removeClass("active"),$("input[name=answer_question_1]").val(t),localStorage.setItem("cliente",t),pushDataLayer("form_field_steps",{pantalla:"pantalla_1-0%",field_name:"01. \xbfTienes un cr\xe9dito Compartamos?",field_value:t})}():"2_1"==t?function e(){let t=$("input[name=answer_question_2_1]").val();if(""==t)return $("#msgError").html("Seleccione una respuesta.").show(),!1;$(".question__content").hide(),"Grupal"==t?($("#q4_1").show(),$("input[name=id_question]").val("4_1"),$("#q4_1 .progress__label span").html("60%"),$("#q4_1 .progress__line").addClass("p60"),$(".desktop-footer").show()):($("#q4_2").show(),$("input[name=id_question]").val("4_2"),$("#q4_2 .progress__label span").html("60%"),$("#q4_2 .progress__line").addClass("p60"),$(".desktop-footer").show()),$("#btnContinue").removeClass("active"),$("#btnContinue").hide(),$("input[name=answer_question_2_1]").val(t),localStorage.setItem("tipoCredito",t),pushDataLayer("form_field_steps",{pantalla:"pantalla_1-30%",field_name:"02. \xbfQu\xe9 tipo de cr\xe9dito tienes?",field_value:t},t)}():"2_2"==t?function e(){let t=$("input[name=answer_question_2_2]").val();if(""==t)return $("#msgError").html("Seleccione una respuesta.").show(),!1;$(".question__content").hide(),"Si"==t?($("#q3_1").show(),$("input[name=id_question]").val("3_1"),$("#q3_1 .progress__label span").html("60%"),$("#q3_1 .progress__line").addClass("p60")):($("#q3_2").show(),$("input[name=id_question]").val("3_2"),$("#q3_2 .progress__label span").html("90%"),$("#q3_2 .progress__line").addClass("p80")),$("#btnContinue").removeClass("active"),$("input[name=answer_question_1]").val(t),localStorage.setItem("negocio",v),pushDataLayer("form_field_steps",{pantalla:"pantalla_1-30%",field_name:"02. \xbfTienes un negocio?",field_value:v})}():"3_1"==t?function e(){let t=$("input[name=answer_question_3_1]").val();if(""==t)return $("#msgError").html("Seleccione una respuesta.").show(),!1;$(".question__content").hide(),g="Si"==t?"Si":"No",$("#q3_2").show(),$("input[name=id_question]").val("3_2"),$("#q3_1 .progress__label span").html("90%"),$("#q3_2 .progress__line").addClass("p80"),$("#btnContinue").removeClass("active"),$("input[name=answer_question_1]").val(t),localStorage.setItem("antiguedad",g),pushDataLayer("form_field_steps",{pantalla:"pantalla_1-60%",field_name:"03. \xbfTu negocio tiene m\xe1s de 6 meses?",field_value:g})}():"3_2"==t?(e="",(window.ssSource,!1===p)?($("#telefonoSelect").val(),$("#horaSelect").val(),$("#txbNombre").val(),$("#msgDatosIncorrectos").html("Verifica que todos los datos sean correctos.").show(),setTimeout(function(){$("#msgDatosIncorrectos").fadeOut()},7e3)):($("#msgDatosIncorrectos").hide(),console.log("Iniciando env\xedo de datos..."),spinnerOn("Registrando informaci\xf3n..."),document.getElementsByName("answer_question_2_1")[0].value,$.ajax({method:"POST",url:endPointSendData,data:function e(t){var o=new FormData;document.getElementById("avisoPrivacidad").checked?o.append("aviso","si"):o.append("aviso","no");var a=document.getElementById("txbApMaterno").value;a.length<3&&(a="N/A");var n=document.getElementById("txbCorreoElectronico").value;n.length<3&&(n="N/A"),o.append("nombre",document.getElementById("txbNombre").value),o.append("aPaterno",document.getElementById("txbApPaterno").value),o.append("aMaterno",a),o.append("correo",n),o.append("telNum",document.getElementById("txbNumeroTel").value.replaceAll("-","").replaceAll(" ","").replaceAll("+","").trim());var r=$("input[name='rbSexo']:checked").val();void 0===r&&(r="N/A"),o.append("genero",r),o.append("negocio",v),o.append("antiguedad",g),o.append("tipoCredito",m),o.append("productoAdicional",C),localStorage.setItem("nombreProspecto",document.getElementById("txbNombre").value),localStorage.setItem("negocio",v),localStorage.setItem("antiguedad",g),localStorage.setItem("tipoCredito",m),localStorage.setItem("productoAdicional",C);let s=document.getElementById("horaSelect").value;o.append("horario","0"===s?"N/A":s),document.getElementById("tipoCreditoGrupal").value,o.append("cliente",u);var i=document.getElementById("anioSelect").value+"/"+document.getElementById("mesSelect").value+"/"+document.getElementById("diaSelect").value;o.append("fechaN",i),o.append("codigoPostal",document.getElementById("txbCP").value);let l=utms();return l.length>0?(o.append("source",""==l.utm_source.trim()?"N/A":l.utm_source),o.append("medium",""==l.utm_medium.trim()?"N/A":l.utm_medium),o.append("campaign",""==l.utm_campaign.trim()?"N/A":l.utm_campaign),o.append("content",""==l.utm_content.trim()?"N/A":l.utm_content)):(o.append("source","N/A"),o.append("medium","N/A"),o.append("campaign","N/A"),o.append("content","N/A")),o.append("token",t),o}(""),contentType:!1,processData:!1,cache:!1,success:function(e){console.log("Respuesta del servidor:",e),spinnerOff(),0==e.codigo?(localStorage.setItem("lead_id",e.solicitud.id),sessionStorage.setItem("Folio",e.solicitud.id),sessionStorage.setItem("Horario",e.solicitud.horario),clickSenderDatakayer(),console.log("Redireccionando..."),function e(){if((()=>{let e=document.getElementById("diaSelect");return e&&null!==e.offsetParent})()){let t=document.getElementById("diaSelect").value,o=document.getElementById("mesSelect").value,a=document.getElementById("anioSelect").value;"0"!==t&&"0"!==o&&"0"!==a?setTimeout(()=>window.location.href="ty-no-cliente.html",600):setTimeout(()=>window.location.href="ty-cliente.html",600)}else setTimeout(()=>window.location.href="ty-cliente.html",600)}()):gestionaError(e)},error:function(e,t,o){dataLayer.push({event:"error_lead",CDFunnel:"Si"==localStorage.getItem("cliente")?"Cliente":"No cliente",CDCategory:localStorage.getItem("tipoCredito"),CDLabel:localStorage.getItem("productoAdicional"),CDAction:"Intento de registro",submit_result:"Error",detail:"Error de conexi\xf3n:"+o}),console.error("Error de conexi\xf3n:",o),spinnerOff(),alert("Error al conectar con el servidor. Intente nuevamente.")},complete:function(){grecaptcha.reset()}}))):"3_3"==t?validateQ3_3():"4_1"==t?w():"4_2"==t?function e(){let t=$("input[name=answer_question_4_2]").val();if($(".desktop-footer").hide(),""==t)return $("#msgError").html("Seleccione una respuesta.").show(),!1;$(".question__content").hide(),C=t,$("#q3_2").show(),$("input[name=id_question]").val("3_2"),$("#q3_2 .progress__label span").html("90%"),$("#q3_2 .progress__line").addClass("p80"),$("#q3_2 .tipoCredito").hide(),$("#btnContinue").removeClass("active"),$("#btnContinue").show()}():"4_3"==t&&validateQ4_3()}),$("#tipoCreditoGrupal").on("change",function(){$(this).val(),w()}),$("#tipoCreditoIndividual").on("change",function(){$(this).val(),w()})});var clickAll=0;function gestionaError(e){var t="";if(e.codigo){if(-1==e.codigo)msErrorsend(t=MSG_ERROR_GRAL);else if(-2==e.codigo)msErrorsend(t="No se pudo enviar la informaci\xf3n. Favor de llenar todos los campos obligatorios.");else if(-4==e.codigo){t="Formato de n\xfamero telef\xf3nico incorrecto.";var o=getCampoTel(e.respuesta);$(o).addClass("req_field")}else if(-5==e.codigo){t="El n\xfamero telef\xf3nico que ingresaste no es v\xe1lido.";var o=getCampoTel(e.respuesta);$(o).addClass("req_field")}else t=MSG_ERROR_GRAL}else t=MSG_ERROR_GRAL;msErrorsend(t),dataLayer.push({event:"error_lead",CDFunnel:"Si"==localStorage.getItem("cliente")?"Cliente":"No cliente",CDCategory:localStorage.getItem("tipoCredito"),CDLabel:localStorage.getItem("productoAdicional"),CDAction:"Intento de registro",submit_result:"Error",detail:t})}function msErrorsend(e){$("#msError").text(e),$("#msError").show();var t=$("#msError").offset().top;$("html, body").animate({scrollTop:t},1e3)}function agregarTipoCreditoGrupal(e){$("#tipoCreditoGrupal").val(e),$("#tipoCreditoGrupal").trigger("change")}function agregarTipoIndividual(e){$("#tipoCreditoIndividual").val(e),$("#tipoCreditoIndividual").trigger("change")}function agregarTipoCreditoGrupal(e){console.log("Tipo de cr\xe9dito seleccionado:",e);let t=e.toLowerCase();if("cuenta a mi favor"===t){window.location.href="ty-cuenta-a-mi-favor.html";return}if("inversiones"===t){window.location.href="ty-inversiones-compartamos.html";return}$("#tipoCreditoGrupal").val(e),$("#tipoCreditoGrupal").trigger("change")}